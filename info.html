<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jobya - 个人信息</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="Themesdesign" />

    <link rel="shortcut icon" href="images/favicon.ico">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">

    <!--Material Icon -->
    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css" />

    <link rel="stylesheet" type="text/css" href="css/fontawesome.css" />

    <!-- selectize css -->
    <link rel="stylesheet" type="text/css" href="css/selectize.css" />

    <link rel="stylesheet" type="text/css" href="css/nice-select.css" />

    <!-- Custom  Css -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />

    <link rel="stylesheet" type="text/css" href="css/notiflix-2.1.2.min.css"/>


</head>

<body>
    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
        </div>
    </div>
    <!-- Loader -->

    <!-- Navigation Bar-->
    <header id="topnav" class="defaultscroll scroll-active">
        
    </header><!--end header-->
    <!-- Navbar End -->
    
    <!-- Start home -->
    <section class="bg-half page-next-level"> 
        <div class="bg-overlay"></div>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="text-center text-white">
                        <h4 class="text-uppercase title mb-4">个人资料</h4>
                        <ul class="page-next d-inline-block mb-0">
                            <li><a href="index.html" class="text-uppercase font-weight-bold">首页</a></li>
                            <li>
                                <span class="text-uppercase text-white font-weight-bold">个人资料</span> 
                            </li> 
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- end home -->

    <!-- POST A JOB START -->
    <section class="section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-4">
                    <div class="rounded shadow bg-white p-4">
                        <div class="custom-form">
                            <div id="message3"></div>
                            <form method="post" action="" name="contact-form" id="ff">
                                <h4 class="text-dark mb-3">个人信息 :</h4>
                                <img onclick="uploadHead.click()" id="head-image" src="images/employers/img-1.jpg" class="img-fluid avatar avatar-medium d-block mx-auto rounded-pill" alt="">
                                <input type="file" name="file" style="display: none;" id="uploadHead" onchange="getFileName()"/>
                                <input type="hidden" name="head" style="display: none;" id="icon" value=""/>
                                <input id="userId" type="hidden" style="display: none;" value="">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">用户名</label>
                                            <input id="userName" type="text" class="form-control resume" placeholder="UserName">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">密码</label>
                                            <input id="password" type="password" class="form-control resume" placeholder="Password">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">邮箱</label>
                                            <input id="email" readonly="readonly" type="email" class="form-control resume" placeholder="Email">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">电话号码</label>
                                            <input id="phone" type="text" class="form-control resume" placeholder="Phone">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">公司社会信用编码</label>
                                            <input id="uniformCreditCode" type="text" class="form-control resume" placeholder="UniformCreditCode" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group position-relative">
                                            <br>
                                            <input style="margin-top: 15px;" type="button" class="form-control" id="verify-code" value="验证" onclick="getCompanyByUniformCreditCode()">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group app-label mt-2">
                                            <label class="text-muted">公司名称</label>
                                            <input id="companyName" type="text" readonly="readonly" class="form-control resume" placeholder="CompanyName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <input id="companyNo" value="" style="display: none;" />
                                </div>

                            
                                <div class="row">
                                    <div class="col-lg-12 mt-2" style="text-align: center;">
                                        <a href="#" onclick="updateUserInfo()" class="btn btn-primary">提交</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- POST A JOB END -->


    <hr>
    <footer class="footer footer-bar">
        
    </footer><!--end footer-->
    <!-- Footer End -->

    <!-- Back to top -->
    <a href="#" class="back-to-top rounded text-center" id="back-to-top"> 
        <i class="mdi mdi-chevron-up d-block"> </i> 
    </a>
    <!-- Back to top -->

    <!-- javascript -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/plugins.js"></script>

    <!-- selectize js -->
    <script src="js/selectize.min.js"></script>

    <script src="js/jquery.nice-select.min.js"></script>

    <script src="js/app.js"></script>

    <script src="js/message.js"></script>

    <script src="js/common.js"></script>

    <script src="js/jquery.params.js"></script>

    <script src="js/notiflix-2.1.2.min.js"></script>


    <script type="text/javascript">
        $(function() {
            loadTopNav();
            loadFootNav();
            setName();
            loadUserInfo();
        })

        // 往表里添值
        function setValue(data) {
            var user = data.data.user;
            var company = data.data.company;
            if (user != null) {
                $("#userId").val(user.userId);
                $("#head-image").attr("src", user.icon);
                $("#icon").val(user.icon);
                $("#userName").val(user.userName);
                $("#password").val(user.password);
                $("#email").val(user.email);
                $("#phone").val(user.phone);
                if (company != null) {
                    $("#companyNo").val(company.companyNo);
                    $("#companyName").val(company.name);
                    $("#uniformCreditCode").val(company.uniformCreditCode);
                }
            }
        }

        // 加载当前登录的用户信息
        function loadUserInfo() {
            var token = localStorage.getItem("token");
            if (token == null) {
                jump();
            }
            token = token.substring(1, token.length - 1);
            $.ajax({
                type:"GET",
                async:false,
                url:defaultUrl + "user/getUserInfoByToken",
                dataType:"json",
                headers:{
                    "token":token
                },
                success:function(data) {
                    if (data.code == 200) {
                        setValue(data);
                    }
                }
            })
        }

        // 修改用户信息
        function updateUserInfo() {
            var userName = getValue("userName");
            var password = getValue("password");
            var email = getValue("email");
            var phone = getValue("phone");
            var icon = getValue("icon");
            var companyNo = getValue("companyNo");
            var userId = getValue("userId");
            if (userName == null || password == null || email == null || phone == null || userId == null) {
                getInfoMsg("请输入完整信息");
                return;
            }  
            var user = {
                userEntity:{
                    "userName":userName,
                    "email":email,
                    "phone":phone,
                    "companyNo":companyNo,
                    "icon":icon,
                    "userId":userId,
                    "password":password
                }
            };
            $.ajax({
                type:"POST",
                async:true,
                url:defaultUrl + "user/updateUserInfo",
                dataType:"json",
                contentType:"application/json;charset=utf-8",
                data:JSON.stringify(user),
                success:function(data) {
                    if (data.code == 200) {
                        setValue(data);
                        localStorage.setItem("userInfo",JSON.stringify(data.data.user));
                        getSuccessMsg(data.message);
                    } else {
                        getFailMsg(data.data);
                    }
                }
            })
        }

        // // 根据社会信用id获取公司信息
        // function getCompanyByUniformCreditCode() {
        //     var uniformCreditCode = getValue("uniformCreditCode");
        //     if (uniformCreditCode == null || uniformCreditCode == true || uniformCreditCode == "") {
        //         getInfoMsg("请先输入社会信用编码");
        //         return;
        //     }
        //     $.ajax({
        //         type:"GET",
        //         async:true,
        //         url:defaultUrl + "company/getCompanyByUniformCreditCode",
        //         dataType:"json",
        //         data:{
        //             "uniformCreditCode":uniformCreditCode
        //         },
        //         success:function(data) {
        //             if (data.code == 200) {
        //                 var company = data.data.company;
        //                 if (company != null) {
        //                     $("#companyName").val(company.name);
        //                     $("#companyNo").val(company.companyNo);
        //                     getSuccessMsg("已检测");
        //                 } else {
        //                     getInfoMsg("该站点不存在该公司信息");
        //                 }
        //             }
        //         }
        //     })
        // }
    </script>
</body>
</html>